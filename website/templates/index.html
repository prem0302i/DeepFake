<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deepfake Detection</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #1a1a1a; color: #fff; margin: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 100vh; padding: 2rem; box-sizing: border-box; }
        .container { display: flex; flex-direction: column; align-items: center; gap: 1.5rem; padding: 2rem; background-color: #2c2c2c; border-radius: 15px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); text-align: center; max-width: 900px; width: 100%; }
        h1 { margin: 0; font-size: 2.5rem; letter-spacing: 2px; text-transform: uppercase; }
        #status-line { font-size: 1.2rem; }
        #prediction, #confidence { font-weight: bold; padding: 0.5rem 1rem; border-radius: 8px; }
        .real { background-color: #28a745; color: #fff; }
        .fake { background-color: #dc3545; color: #fff; }
        #video-container { border: 3px solid #444; border-radius: 10px; overflow: hidden; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); width: 100%; max-width: 640px; aspect-ratio: 4 / 3; background-color: #000; }
        #video-container img, #video-container video { width: 100%; height: 100%; display: block; }
        .upload-form, .controls { display: flex; flex-direction: column; align-items: center; gap: 1rem; }
        input[type="file"] { display: none; }
        label, input[type="submit"], button { background-color: #007bff; color: #fff; padding: 0.8rem 1.5rem; border-radius: 5px; cursor: pointer; transition: background-color 0.3s ease; border: none; font-size: 1rem; }
        label:hover, input[type="submit"]:hover, button:hover { background-color: #0056b3; }
        #reset-button { background-color: #6c757d; }
        #reset-button:hover { background-color: #5a6268; }
        #theme-switcher { position: absolute; top: 20px; right: 20px; }
        .light-theme { background-color: #f0f0f0; color: #1a1a1a; }
        .light-theme .container { background-color: #fff; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); }
        .light-theme #video-container { border-color: #ccc; }
        #progress-container { width: 100%; background-color: #444; border-radius: 8px; overflow: hidden; display: none; margin-top: 1rem; }
        #progress-bar { width: 0%; height: 25px; background-color: #007bff; text-align: center; line-height: 25px; color: white; transition: width 0.4s ease; }
    </style>
</head>
<body>
    <div class="container">
        <button id="theme-switcher">Toggle Theme</button>
        <h1>Deepfake Detection</h1>
        <p id="status-line">Status: <span id="prediction">Ready</span> <span id="confidence"></span></p>
        <div id="video-container">
            <p>Upload a video to begin analysis.</p>
            <video id="processed-video" controls style="display:none;"></video>
        </div>
        <div class="controls">
            <form id="upload-form" class="upload-form" method="post" enctype="multipart/form-data">
                <label for="file-upload">Choose a video file</label>
                <input id="file-upload" type="file" name="video" accept="video/*">
                <input type="submit" value="Upload and Analyze">
            </form>
            <button id="reset-button" style="display:none;">Reset</button>
        </div>
        <div id="progress-container">
            <div id="progress-bar">0%</div>
        </div>
    </div>

    <script>
        function checkStatus() {
            fetch('/status')
                .then(response => response.json())
                .then(data => {
                    const predictionSpan = document.getElementById('prediction');
                    const confidenceSpan = document.getElementById('confidence');
                    const resetButton = document.getElementById('reset-button');
                    const uploadForm = document.getElementById('upload-form');
                    const progressContainer = document.getElementById('progress-container');
                    const progressBar = document.getElementById('progress-bar');
                    const videoContainer = document.getElementById('video-container');

                    predictionSpan.className = '';

                    if (data.status === 'processing') {
                        videoContainer.innerHTML = `<p>${data.message || 'Processing...'}</p>`;
                        uploadForm.style.display = 'none';
                        resetButton.style.display = 'none';
                        progressContainer.style.display = 'block';
                        const progress = data.progress || 0;
                        progressBar.style.width = progress + '%';
                        progressBar.innerText = Math.round(progress) + '%';
                    } else if (data.status === 'done') {
                        if (predictionInterval) {
                            clearInterval(predictionInterval);
                            predictionInterval = null;
                        }
                        progressContainer.style.display = 'none';
                        predictionSpan.innerText = data.prediction;
                        confidenceSpan.innerText = ''; // No confidence in this version
                        uploadForm.style.display = 'none';
                        resetButton.style.display = 'block';
                    } else if (data.status === 'error') {
                        if (predictionInterval) {
                            clearInterval(predictionInterval);
                            predictionInterval = null;
                        }
                        progressContainer.style.display = 'none';
                        alert(data.message);
                        resetState();
                    } else { // Idle
                        videoContainer.innerHTML = '<p>Upload a video to begin analysis.</p>';
                        predictionSpan.innerText = 'Ready';
                        confidenceSpan.innerText = '';
                        uploadForm.style.display = 'flex';
                        resetButton.style.display = 'none';
                        progressContainer.style.display = 'none';
                    }

                    if (data.prediction && data.prediction.includes('REAL')) {
                        predictionSpan.classList.add('real');
                    } else if (data.prediction && data.prediction.includes('FAKE')) {
                        predictionSpan.classList.add('fake');
                    }
                });
        }

        function resetState() {
            fetch('/reset', { method: 'POST' })
                .then(() => {
                    if (!predictionInterval) {
                        predictionInterval = setInterval(checkStatus, 2000);
                    }
                    checkStatus();
                });
        }

        let predictionInterval = setInterval(checkStatus, 2000);

        document.addEventListener('DOMContentLoaded', () => {
            const uploadForm = document.getElementById('upload-form');
            const fileInput = document.getElementById('file-upload');
            const resetButton = document.getElementById('reset-button');

            uploadForm.addEventListener('submit', function(e) {
                e.preventDefault();
                if (fileInput.files.length === 0) {
                    alert('Please select a video file to upload.');
                    return;
                }
                const formData = new FormData(this);
                fetch('/upload', {
                    method: 'POST',
                    body: formData
                }).then(response => {
                    if(response.ok) {
                        checkStatus(); // Start polling for status
                    }
                }).catch(error => console.error('Error uploading file:', error));
            });

            resetButton.addEventListener('click', resetState);
            
            const themeSwitcher = document.getElementById('theme-switcher');
            const body = document.body;
            themeSwitcher.addEventListener('click', () => {
                body.classList.toggle('light-theme');
                localStorage.setItem('theme', body.classList.contains('light-theme') ? 'light' : 'dark');
            });

            const savedTheme = localStorage.getItem('theme') || 'dark';
            if (savedTheme === 'light') {
                body.classList.add('light-theme');
            }
        });
    </script>
</body>
</html>
